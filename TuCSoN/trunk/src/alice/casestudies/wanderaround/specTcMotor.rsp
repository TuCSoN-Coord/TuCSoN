reaction(
	time(200),
	endo,
	(
		out(input(ag_collide)),
		out(input(tc_runaway)),
		out(can_suppress(tc_runaway,tc_avoid,5000))
	)
).

reaction( 
	in(can_suppress(Tci,Tcs,Time)), 
	(exo, response),
	( 
		in(input(Tci)), out(input(Tcs)),
		current_time(CurrentT), NewTime is CurrentT + Time,
		out_s( 
			time(NewTime), 
			endo,
			( 
				in(input(Tcs)), out(input(Tci)),
				out(can_suppress(Tci,Tcs,Time))
			)
		)
	)
).

reaction( 
	out(data(X)), 
	(exo, response),
	( 
		event_source(tc_runaway@localhost:20504), rd(input(tc_runaway)),
		in(data(X)), out(X) 
	)
).

reaction( 
	out(data(X)), 
	(exo, response),
	( 
		event_source(tc_avoid@localhost:20504), rd(input(tc_avoid)),
		in(data(X)), out(X) 
	)
).

reaction( 
	out(data(X)), 
	(exo, response),
	( 
		event_source(Tc), no(input(Tc)),
		in(data(X))
	)
).

reaction( 
	in(can_inhibit(Tco,Tcs,Time)), 
	(exo, response),
	( 
		in(output(Tco)),
		current_time(CurrentT), NewTime is CurrentT + Time,
		out_s( 
				time(NewTime), 
				endo,
				( 
					out(output(Tco)),
					out(can_inhibit(Tco,Tcs,Time))
				)
		)
	)
).

reaction( 
	inp(data(X)), 
	(from_agent, request),
	( 
		in(X),
		event_source(Ag), rd(output(Ag)),
		out(X) 
	)
).

reaction( 
	out(halt),
	endo,
	(
		in(halt),
		tc_m1 ? out(command(power,0)),
		tc_m2 ? out(command(power,0)) 
	)
).

reaction( 
	out(command(Angle,Speed)),
	endo,
	(
		no(pending(Id,Type)),
		tc_m1@localhost:20504 ? out(command(angle,Angle)),
		out(pending(tc_m1,angle)),
		M2_angle is - Angle,
		tc_m2@localhost:20504 ? out(command(angle,M2_angle)), 
		out(pending(tc_m2,angle)),
		tc_m1@localhost:20504 ? out(command(power,Speed)), 
		out(pending(tc_m1,power)),
		tc_m2@localhost:20504 ? out(command(power,Speed)), 
		out(pending(tc_m2,power))
	)
).

reaction( 
	out(command(Type,_)), 
	(link_out, response),
	( 
		event_target(Tc), 
		in(pending(Tc,Type)) 
	)
).

reaction( 
	out(command(Type,_)), 
	(link_out, response),
	( 
		event_target(Tc), 
		out(tc(Tc))
	)
).
