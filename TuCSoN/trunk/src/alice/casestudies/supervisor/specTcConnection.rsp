
% ReSpecT specification used into tc_connection ( LIGHT SUPERVISOR CASE STUDY )

% Initialization tuples
reaction(
	time(200),
	endo,
	(
		out(connection_status(bad)),
		out(input(ag_connection)),
		out(output(ag_connection))
	)
).

% Checks reading permissions
reaction(
	inp(connection_status(X)),
	(from_agent, request),
	(
		in(connection_status(X)),
		event_source(Src), rd(output(Src)),
		out(connection_status(X))
	)
).

% Checks writing permissions
reaction(
	out(cmd(X)),
	(exo, success),
	(
		in(cmd(X)),
		event_source(Src), rd(input(Src)),
		out(X)
	)
).

% Reacts to environment event
reaction(
	getEnv(status,X),
	from_env,
	(
		in(reading(status,OldV)),
		out(reading(status,X))
	)
).

reaction(
	getEnv(status,X),
	from_env,
	(
		no(reading(status,OldV)),
		out(reading(status,X))
	)
).

% Refresh connection's status
reaction(
	out(reading(status,X)),
	(internal, response),
	(
		in(reading(status,X)),
		in(connection_status(OldS)),
		out(connection_status(ok))
	)
).

reaction(
	out(reading(status,X)),
	(internal, response),
	(
		in(reading(status,X)),
		no(connection_status(OldS)),
		out(connection_status(ok))
	)
).

% Starts check connection routine
reaction(
	out(check_connection),
	(internal, response),
	in(check_connection)
).

% Asks the environment to notify the connection's status
reaction(
	in(check_connection),
	internal,
	connection ? getEnv(status,X)
).

% Notifies connection's status to the supervisor
reaction(
	out(notify_status(X)),
	(internal, response),
	(
		in(notify_status(X)),
		connection ? setEnv(status,X)
	)
).
	
	
		